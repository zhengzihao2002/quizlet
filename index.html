<!DOCTYPE html>
<html>
<head>
    <title>复习单词</title>
    <style>
        body {
            margin: 0;
            padding: 20px 30px;
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
            background-color: rgb(228, 228, 228);
        }

        .container {
            height: 100vh;
            transform-style: preserve-3d;
            position: relative;
        }

        .card {
            transform-style: preserve-3d;
            /* flex: 9; */
            height: 85%;
            width: 100%;
            background: #fff;
            transition: transform 0.5s;
            cursor: pointer;
            position: absolute;
            top:0;
            left:0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            font-size: 100px;
            font-weight: bolder;
            transition: transform 0.7s ease;
        }

        .trans{
            /* left, transform  */
            transition: all 0.5s;
        }
        .card.flip {
            transform: rotateY(180deg);
        }

        .card-inner {
            width: 100%;
            height: 100%;
        }

        .button-container {
            margin-top: 20px;
            text-align: center;
            position: absolute;
            top: 87%;
            left: 0;
            right: 0;
        }
        .front,.back{
            backface-visibility: hidden;
            
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            line-height: 100%;
        }
    
        .front{
            z-index: 1;
        }
        .back{
            transform: rotateY(180deg);
        }
        .button {
            background: #007bff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin-right: 20px;
        }

        .button:hover {
            background: #0056b3;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            border-top: 4px solid #007BFF; /* Change the color here */
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            position: fixed;
            top: 50%;
            left: 50%;
            /* transform: translate(-50%, -50%); */
            margin-top: -25px; /* Half of the height */
            margin-left: -25px; /* Half of the width */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- consider adding two cards to left and right out of screen that has prev and next def, then we hit next and the next card slides in  -->
    <div class="loading-spinner" style="display: none;"></div>

    <div style="z-index: 2;width: 100%;height: 85%;position: absolute;display: none;" id="dat">
        <textarea name="" style="resize: none;
        height: 85vh;width: 96vw;" id="txt"></textarea>
    </div>
    <div class="container">
        <div class="card trans" onclick="flipCard()">
            <div class="front">
                word
            </div>
            <div class="back" style="background-image: url(indexcard.jpg);background-size: 100% 100%; 
            background-repeat: no-repeat;">
                def
            </div>
        </div>
        <div class="card trans" id="temp" style="left: 110%;" >
            <div class="front">
                word
            </div>
            <div class="back" style="background-image: url(indexcard.jpg);background-size: 100% 100%; 
            background-repeat: no-repeat;">
                def
            </div>
        </div>
        <div class="button-container" style="">
            <span id="showIndex" style="font-size: 30px;margin-right: 20px;position: absolute;left: 50px;">1</span>
            <!-- <button class="button" id="prevButton">Prev</button> -->
            <button class="button" id="nextButton" onclick="nextCard()">下个单词</button>
            <button class="button" id="dataButton" onclick="loadData()">输入单词</button>
            <span id="" style="font-size: 13px;margin-left: 20px;position: absolute;right: 50px;">温馨提示：省电模式下可能出现动画异常</span>
            <span id="" style="font-size: 12px;margin-left: 20px;position: absolute;top:20px;right: 0;">温馨提示：输入数据时，每行代表一个Vocab，Word和Definition用空格分离（单词哪不要用空格）</span>
            <span id="" style="font-size: 12px;margin-left: 20px;position: absolute;top:40px;right: 0;">温馨提示：清空浏览器缓存会导致单词丢失！</span>
        </div>
    </div>

    <script>
        const card = document.querySelector('.card');
        const wordElement = document.querySelector('.front');
        const definitionElement =  document.querySelector('.back');
        const nextButton = document.getElementById('nextButton');
        let temp = document.querySelector("#temp");
        const tempfront = temp.querySelector('.front');
        const tempback =  temp.querySelector('.back');

        const height = document.querySelector('.front').clientHeight;
        const frontElements = document.querySelectorAll('.front');
        const backElements = document.querySelectorAll('.back');

        let status = 0;// 默认正面

        frontElements.forEach(element => {
            element.style.lineHeight = `${height}px`;
        });

        backElements.forEach(element => {
            element.style.lineHeight = `${height}px`;
        });


        let vocabulary = [
            { word: 'Loading...', definition: '1' },
            { word: 'Loading...', definition: '2' },
        ];


        let currentIndex = 0;

        function updateCard() {
            wordElement.textContent = vocabulary[currentIndex].word;
            definitionElement.textContent = vocabulary[currentIndex].definition;

            temp.classList.remove("trans");
            card.classList.remove("trans");
            

            temp.style.left = "110%";
            card.style.left = "0";

            setTimeout(() => {
                temp.classList.add("trans");
                card.classList.add("trans");
            }, 10);

            setTimeout(() => {
                if(currentIndex+1>vocabulary.length-1){
                    tempfront.textContent = vocabulary[0].word;
                    tempback.textContent = vocabulary[0].definition;
                }else{
                    tempfront.textContent = vocabulary[currentIndex+1].word;
                    tempback.textContent = vocabulary[currentIndex+1].definition;
                }
            }, 20);
            
            
            // temp.classList.add("trans");
            // card.classList.add("trans");
            
        }
        function initCard(){
            vocabulary = JSON.parse(localStorage.getItem('vocabulary')) || [];
            const textarea = document.querySelector('#txt');
            const vocabularyText = vocabulary.map(item => `${item.word} ${item.definition}`).join('\n');
            textarea.value = vocabularyText;

            if(vocabulary.length==0){
                vocabulary = [
                    { word: 'Loading...', definition: '1' },
                    { word: 'Loading...', definition: '2' },
                ];
                currentIndex = 0;
            }
            wordElement.textContent = vocabulary[currentIndex].word;
            definitionElement.textContent = vocabulary[currentIndex].definition; 
            

            if(currentIndex+1>=vocabulary.length-1){
                tempfront.textContent = vocabulary[0].word;
                tempback.textContent = vocabulary[0].definition;
            }else{
                tempfront.textContent = vocabulary[currentIndex+1].word;
                tempback.textContent = vocabulary[currentIndex+1].definition;
            }

        }
        function flipCard() {
            if(status == 0){
                // 正面 = 0
                status ++;
                card.classList.toggle('flip');
            }else{
                // 反面 = 1
                status --;
                card.classList.toggle('flip');
            }
        }

        let lastExecutionTime = 0;

        function nextCard() {
            if(status==1){
                flipCard();
            }
            currentIndex = (currentIndex + 1) % vocabulary.length;

            let field1 = currentIndex+1;
            let field2 = "/";
            let field3 = vocabulary.length;
            let field = field1+field2+field3;

            document.querySelector("#showIndex").textContent=field;

            // determine card status then flip
            // it costs 0.5s to flip
            // flipCard();
            // setTimeout(updateCard, 500);


            // temp.style.transition = "left 0.5s";
            temp.style.left = "0";
            card.style.left = "-110%"

            setTimeout(updateCard, 500);
        
        }
        let throttleTimeout;
        const throttleDelay = 500; // 0.5 seconds

        function throttleNextCard() {
            if (!throttleTimeout) {
                // Execute nextCard() if no throttle is pending
                nextCard();
                throttleTimeout = setTimeout(function () {
                    // Clear the throttle after the delay
                    throttleTimeout = null;
                }, throttleDelay);
            }
        }

        // Add event listeners to the document
        document.addEventListener('keydown', function (event) {
        if (event.key === ' ') {
            // Check if the spacebar is pressed, and run flipCard()
            flipCard();
        } else if (event.key === 'ArrowRight') {
            // Check if the right arrow key is pressed, and click nextCard()
            throttleNextCard();
        }
        });

        document.getElementById('dataButton').addEventListener('keydown', function (e) {
            if (e.key === ' ') {
                e.preventDefault();
            }
        });


        let stat = 0;
        function loadData(){
            if(stat==1){
                // save
                const textarea = document.getElementById('txt');
                const text = textarea.value;
                const lines = text.split('\n');
                const vocabulary = [];
                lines.forEach(line => {
                    const parts = line.trim().split(' ');
                    if (parts.length === 2) {
                        vocabulary.push({ word: parts[0], definition: parts[1] });
                    }
                });

                // Store the updated vocabulary in local storage
                localStorage.setItem('vocabulary', JSON.stringify(vocabulary));
                
                // update cards
                initCard();
                


                document.querySelector("#dat").style.display = "none";
                stat=0;
                // Refresh the webpage
                // location.reload();
                return;
            }
            // load
            document.querySelector("#dat").style.display = "block";
            vocabulary = JSON.parse(localStorage.getItem('vocabulary')) || [];
            const textarea = document.querySelector('#txt');
            const vocabularyText = vocabulary.map(item => `${item.word} ${item.definition}`).join('\n');
            console.log(textarea);
            textarea.value = vocabularyText;
            
            stat=1;
        }


        // Initialize the card with the first word and definition
        initCard();
        let field1 = currentIndex+1;
        let field2 = "/";
        let field3 = vocabulary.length;
        let field = field1+field2+field3;

        document.querySelector("#showIndex").textContent=field;
    </script>
</body>
</html>
